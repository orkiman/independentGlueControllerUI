<UserControl x:Class="GlueControllerUI.Views.CalibrationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    
    <StackPanel Margin="20" MaxWidth="500">
        <TextBlock Text="Calibration" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,20"/>
        
        <!-- Instructions -->
        <materialDesign:Card Padding="20" Margin="0,0,0,15">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <materialDesign:PackIcon Kind="Information" 
                                              VerticalAlignment="Center"
                                              Foreground="{DynamicResource PrimaryHueMidBrush}"
                                              Width="24" Height="24"
                                              Margin="0,0,10,0"/>
                    <TextBlock Text="Calibration Instructions" 
                               Style="{StaticResource MaterialDesignHeadline6TextBlock}"/>
                </StackPanel>
                
                <TextBlock TextWrapping="Wrap" Style="{StaticResource MaterialDesignBody2TextBlock}">
                    1. Enter the page length in mm (distance between sensor triggers)
                    <LineBreak/>
                    2. Click "Start Calibration"
                    <LineBreak/>
                    3. Pass one complete page through the sensor
                    <LineBreak/>
                    4. The encoder pulses will be counted and pulses/mm calculated
                </TextBlock>
            </StackPanel>
        </materialDesign:Card>
        
        <!-- Page Length Input -->
        <materialDesign:Card Padding="20" Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="Page Length" Style="{StaticResource MaterialDesignBody1TextBlock}" Margin="0,0,0,10"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox Grid.Column="0"
                             Text="{Binding CalibrationPageLength, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Page length (mm)"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,10,0"/>
                    
                    <TextBlock Grid.Column="1" 
                               Text="mm" 
                               VerticalAlignment="Center"
                               Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                </Grid>
                
                <Button Content="START CALIBRATION"
                        Command="{Binding StartCalibrationCommand}"
                        IsEnabled="{Binding IsCalibrating, Converter={StaticResource InverseBoolConverter}}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Margin="0,20,0,0"/>
            </StackPanel>
        </materialDesign:Card>
        
        <!-- Calibration Status -->
        <materialDesign:Card Padding="20" Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="Status" Style="{StaticResource MaterialDesignBody1TextBlock}" Margin="0,0,0,10"/>
                
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <ProgressBar IsIndeterminate="True" 
                                 Visibility="{Binding IsCalibrating, Converter={StaticResource BooleanToVisibilityConverter}}"
                                 Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 Width="20" Height="20"
                                 Margin="0,0,10,0"/>
                    <TextBlock Text="{Binding CalibrationResult}" 
                               Style="{StaticResource MaterialDesignBody2TextBlock}"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </StackPanel>
        </materialDesign:Card>
        
        <!-- Current Encoder Value -->
        <materialDesign:Card Padding="20">
            <StackPanel>
                <TextBlock Text="Current Configuration" Style="{StaticResource MaterialDesignBody1TextBlock}" Margin="0,0,0,10"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Encoder Resolution:" Style="{StaticResource MaterialDesignBody2TextBlock}"/>
                    <TextBlock Grid.Column="1" Style="{StaticResource MaterialDesignBody1TextBlock}">
                        <Run Text="{Binding Config.EncoderPulsesPerMm, StringFormat=F2}"/>
                        <Run Text=" pulses/mm"/>
                    </TextBlock>
                </Grid>
            </StackPanel>
        </materialDesign:Card>
    </StackPanel>
</UserControl>
